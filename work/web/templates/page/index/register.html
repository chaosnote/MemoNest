{{template "share" .}}

{{define "css"}}
{{end}}

{{define "content"}}
<div class="card-body">
  <div class="mb-3">
    <div class="input-group">
      <span class="input-group-text">帳號</span>
      <input type="text" class="form-control" id="account" name="account" placeholder="請輸入帳號" value="{{.Setting.Account}}">
    </div>
    <div class="invalid-feedback">請輸入帳號</div>
  </div>

  <div class="mb-3">
    <div class="input-group">
      <span class="input-group-text">密碼</span>
      <input type="password" class="form-control" id="password" name="password" placeholder="請輸入密碼" value="{{.Setting.Password}}">
    </div>
    <div class="invalid-feedback">請輸入密碼</div>
  </div>

  <div class="mb-3">
    <div class="input-group">
      <span class="input-group-text">確認</span>
      <input type="password" class="form-control" id="confirm" name="confirm" placeholder="再次輸入密碼">
    </div>
    <div class="invalid-feedback">請再次輸入密碼</div>
  </div>

  <div class="mb-3 text-danger" id="errorMessage" style="display:none;">
    註冊失敗，請確認輸入內容。
  </div>

  <button id="registerBtn" class="btn btn-primary w-100">
    <span class="spinner-border spinner-border-sm me-2 d-none" role="status" id="loadingSpinner"></span>
    註冊
  </button>

  <div class="mt-3 text-center">
    已有帳號？<a href="/">返回登入</a>
  </div>
</div>
{{end}}

{{define "js"}}
<script>
$(document).ready(function () {
  $('#register-form').on('submit', function (e) {
    e.preventDefault(); // 防止預設送出

    const account = $('#account').val().trim();
    const password = $('#password').val();
    const confirm = $('#confirm').val();
    const errorBox = $('#error-message');

    errorBox.hide().text('');

    if (account === '') {
      errorBox.text('請輸入帳號').show();
      return;
    }

    if (password.length < 6) {
      errorBox.text('密碼至少需 6 字元').show();
      return;
    }

    if (password !== confirm) {
      errorBox.text('兩次輸入的密碼不一致').show();
      return;
    }

    // ✅ 若要改為 AJAX 註冊，可使用以下：
    $.ajax({
      url: '/api/v1/member/register',
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({ account, password }),
      success: function (res) {
        if (res.Code === 'OK') {
          window.location.href = '/login';
        } else {
          errorBox.text(res.Code).show();
        }
      },
      error: function () {
        errorBox.text('註冊失敗，請稍後再試').show();
      }
    });
  });
});
</script>
{{end}}