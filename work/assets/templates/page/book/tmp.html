{{template "share" .}}

{{define "css"}}
<style>
    /* ------------------------------------------- */
    /* 主介面 - 文字顯示區樣式 */
    /* ------------------------------------------- */
    #displaySelected {
        border: 1px solid #ced4da; 
        padding: .375rem .75rem;
        background-color: #e9ecef; /* 淺灰色背景 */
        min-width: 150px; 
        border-radius: .25rem; 
        color: #495057;
        font-weight: bold;
        flex-shrink: 0; 
    }

    /* ------------------------------------------- */
    /* 彈跳 Panel - 120x120 大按鈕樣式 (使用 Flexbox 排版) */
    /* ------------------------------------------- */
    .big-square-button {
        width: 120px; /* 寬度 120px */
        height: 120px; /* 高度 120px */
        
        /* 使用 Flexbox 確保內容在按鈕內垂直和水平置中 */
        display: flex;
        align-items: center; 
        justify-content: center; 
        
        font-size: 1.1rem; 
        font-weight: bold;
        text-align: center; 
        white-space: normal; /* 允許文字換行 */
    }
    
    /* 確保 Modal 內容區有足夠的內距 */
    .modal-body {
        padding: 1.5rem;
    }
</style>
{{end}}

{{define "content"}}
<div class="container mt-5">
    <h1>主介面操作區</h1>
    
    <div class="d-flex align-items-center gap-2 mb-4">
        
        <button type="button" class="btn btn-primary flex-shrink-0" data-bs-toggle="modal" data-bs-target="#panelModal">
            展開
        </button>
        
        <span id="displaySelected">尚未挑選內容</span>

        <input type="text" class="form-control" id="mainTextInput" placeholder="輸入額外資訊或備註">

        <button type="button" class="btn btn-success flex-shrink-0" id="mainSubmitBtn">
            送出
        </button>
    </div>
    <p class="text-muted">（點擊送出按鈕將會用瀏覽器 Console 輸出：挑選內容 + 輸入內容）</p>
</div>
<div class="modal fade" id="panelModal" tabindex="-1" aria-labelledby="panelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="panelModalLabel">請選擇一個項目 (120x120)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex flex-wrap gap-3 justify-content-center" id="modalButtonsContainer"> 
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="訂單編號-A100">
                        訂單<br>A100
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="產品名稱-P055">
                        產品<br>P055
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="客戶名稱-C123">
                        客戶<br>C123
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="流程狀態-完成">
                        流程<br>完成
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="其他自訂標籤">
                        自訂<br>標籤
                    </button>

                    <button type="button" class="btn btn-outline-info big-square-button" data-value="訂單編號-A100">
                        訂單<br>A100
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="產品名稱-P055">
                        產品<br>P055
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="客戶名稱-C123">
                        客戶<br>C123
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="流程狀態-完成">
                        流程<br>完成
                    </button>
                    
                    <button type="button" class="btn btn-outline-info big-square-button" data-value="其他自訂標籤">
                        自訂<br>標籤
                    </button>
                    
                </div>
                
                <hr class="mt-4">
                <p class="text-center text-muted">點擊上方的按鈕，會將其值填入主畫面的顯示區。</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉 Panel</button>
            </div>
        </div>
    </div>
</div>
{{end}}

{{define "js"}}
<script>
    $(document).ready(function() {
        
        // ----------------------------------------------------------------
        // 處理主介面的 "送出" 按鈕
        // ----------------------------------------------------------------
        $("#mainSubmitBtn").on("click", function() {
            // 1. 取得文字顯示區的值 (挑選的內容)
            const selectedContent = $("#displaySelected").text();
            // 2. 取得文字輸入框的值 (額外輸入的內容)
            const additionalInput = $("#mainTextInput").val();
            
            if (selectedContent === "尚未挑選內容") {
                alert("請先點擊展開按鈕，挑選一個主要項目！");
                return;
            }

            const finalData = {
                selected_item: selectedContent,
                additional_input: additionalInput || "(無額外輸入)" 
            };
            
            // 模擬發送到 Go 後端
            console.log("最終送出資料:", finalData);
            alert(`資料已準備送出！\n主要項目: ${finalData.selected_item}\n額外輸入: ${finalData.additional_input}`);
        });

        // ----------------------------------------------------------------
        // 處理 Panel 內的 "項目按鈕"
        // ----------------------------------------------------------------
        // 使用事件委派，綁定容器內所有 .big-square-button 的點擊事件
        $("#modalButtonsContainer").on("click", ".big-square-button", function() {
            // 1. 取得按鈕上的資料值 (data-value)
            const selectedValue = $(this).data("value");
            
            // 2. 填入主畫面的 文字顯示區
            $("#displaySelected").text(selectedValue);
            
            // 3. 關閉彈跳視窗
            const modalEl = document.getElementById('panelModal');
            const modal = bootstrap.Modal.getInstance(modalEl); 
            if (modal) {
                    modal.hide(); 
            } 
        });
    });
</script>
{{end}}