{{template "share" .}}

{{define "css"}}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
    /* ------------------------------------------- */
    /* 主介面 - 文字顯示區樣式 */
    /* ------------------------------------------- */
    #displaySelected {
        border: 1px solid #ced4da;
        padding: .375rem .75rem;
        background-color: #e9ecef;
        /* 淺灰色背景 */
        min-width: 150px;
        border-radius: .25rem;
        color: #495057;
        font-weight: bold;
        flex-shrink: 0;
    }
    /* 確保 Modal 內容區有足夠的內距 */
    .modal-body {
        padding: 1.5rem;
    }
</style>
{{end}}

{{define "content"}}
{{/** 標題欄位 */}}
<div class="mb-3">
    <input type="text" class="form-control" id="articleTitle" value="{{.ArticleTitle}}">
</div>

{{/** 節點選擇按鈕 */}}
<div class="d-flex align-items-center gap-2 mb-3">
    <span id="displaySelected">&nbsp;</span>
</div>

{{/** Quill 編輯器 */}}
<div class="mb-3">
    <div id="editor" style="height: 600px;"></div>
</div>

{{/** 送出按鈕 */}}
<button class="btn btn-success" onclick="submit()">送出</button>
{{end}}

{{define "js"}}
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
    let id = "{{.ID}}";
    let path_name = "{{.PathName}}";

    document.getElementById("displaySelected").textContent = path_name;
</script>

<script>
    const quill = new Quill('#editor', {
        theme: 'snow',
        placeholder: "請輸入文章內容...",
        modules: {
            toolbar: [
                [{ font: [] }, { size: ['small', false, 'large', 'huge'] }],
                [{ color: [] }, { background: [] }],
                ['bold', 'italic', 'underline'],
                [{ list: 'ordered' }, { list: 'bullet' }],
                ['link', 'image'],
                ['clean']
            ]
        }
    });
    quill.root.innerHTML = '{{trans .ID .ArticleContent}}' ;

    function onBlur(event){
        $(event.target).blur();
    }

    function submit() {
        const title = document.getElementById("articleTitle").value.trim();

        if (!title) return alert("請輸入文章標題！");
        if (!quill.root.innerText) return alert("請輸入文章內容！");

        const params = {
            id: id,
            title: title,
            content: quill.root.innerHTML
        };

        $.ajax({
            url: "/api/v1/article/renew",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(params),
            success: function (response) {
                if (!response.hasOwnProperty('Code')) {
                    location.href = "/" ;
                    return;
                }
                console.log(response.Code) ;
                if( response.Code == "OK"){
                    alert("修改文章成功！");
                    location.reload();
                    return;
                }
                alert("修改文章失敗", response.Code);
            },
            error: function (xhr, status, error) {
                console.error("修改文章失敗：", error);
                alert("修改文章失敗，請稍後再試！");
            }
        });
    }
</script>
{{end}}
